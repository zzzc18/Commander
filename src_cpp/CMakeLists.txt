cmake_minimum_required(VERSION 3.0)
project(cpp_for_lua)
if (CMAKE_HOST_WIN32)
    set(WINDOWS 1)
elseif(CMAKE_HOST_APPLE)
    set(MACOS 1)
elseif(CMAKE_HOST_UNIX)
    set(LINUX 1)
endif()
set(CMAKE_CXX_STANDARD 17)
#find include path
include_directories(include)
if(WINDOWS)
    find_package(Lua51 REQUIRED)
    include_directories(${LUA_INCLUDE_DIR})
    #position of .dll file
    set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/../lib)
elseif(LINUX)
    #position of .so file
    set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/../lib)
endif()
#add source files to variable MAT_SOURCE_FILES
aux_source_directory(mat MAT_SOURCE_FILES)
aux_source_directory(geometry GEOMETRY_SOURCE_FILES)
aux_source_directory(calcDistance CALCDISTANCE_SOURCE_FILES)
aux_source_directory(jsoncpp JSONCPP_SOURCE_FILES)
aux_source_directory(army ARMY_SOURCE_FILES)
aux_source_directory(verify VERIFY_SOURCE_FILES)
aux_source_directory(record RECORD_SOURCE_FILES)
aux_source_directory(button BUTTON_SOURCE_FILES)
#generate .so file
add_library(mat SHARED ${MAT_SOURCE_FILES} ${GEOMETRY_SOURCE_FILES} ${JSONCPP_SOURCE_FILES})
add_library(geometry SHARED ${GEOMETRY_SOURCE_FILES})
add_library(calcDistance SHARED ${CALCDISTANCE_SOURCE_FILES})
add_library(army SHARED ${ARMY_SOURCE_FILES} ${JSONCPP_SOURCE_FILES})
add_library(record SHARED ${RECORD_SOURCE_FILES})
add_library(verify SHARED ${VERIFY_SOURCE_FILES})
add_library(button SHARED ${BUTTON_SOURCE_FILES})
if(WINDOWS)
    target_link_libraries(mat ${LUA_LIBRARIES})
    target_link_libraries(verify ${LUA_LIBRARIES})
    target_link_libraries(button ${LUA_LIBRARIES})
    target_link_libraries(geometry mat ${LUA_LIBRARIES})
    target_link_libraries(calcDistance mat geometry ${LUA_LIBRARIES})
    target_link_libraries(army mat calcDistance verify ${LUA_LIBRARIES})
    target_link_libraries(record verify ${LUA_LIBRARIES})
elseif(LINUX)
    target_link_libraries(geometry mat)
    target_link_libraries(calcDistance mat geometry)
    target_link_libraries(army mat calcDistance verify)
    target_link_libraries(record verify)
endif()
#change name: e.g. libmat.so->lib_mat.so
set_target_properties(mat geometry calcDistance verify army record button PROPERTIES PREFIX "")
